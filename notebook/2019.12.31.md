### ANCOVA of SPF vs GF mice
##### 12/31/2019<br>Sumeed Yoyo Manzoor<br>[The Chang Lab](https://changlab.uchicago.edu/) at the University of Chicago

###### Continued from []().<br>Continued on []().

Built an ANCOVA pipeline to analyze RMR data from realtime metabolic cages data.

![pipeline](../img/2019.12.31-01.png)

See MouseTrapper project.

I used RMR data from the SPF and GF mice experiments.  
SPF data: "Katya_201910041550_rt.csv" on IM3, renamed to "SPF WT vs Bmal1KO RMR.txt". In this dataset, mouse 4 died during the experiment and was excluded from the analysis.  
GF data: "GF_RMR_201912101635_rt.csv" on IM3, renamed to "GF RMR.txt" (will eventually be renamed to "GF WT RMR.txt"). In this dataset, mouse 6 was contaminated and thus excluded from the analysis.

Preliminary visualizations of the data:
<iframe src="test.html" width="850" height="550"></iframe>

First, data was prepared for R using python in a Jupyter notebook. Environment was `Env5_metcages`.

```Python
import numpy as np
import pandas as pd
import functions as mt    # Will eventually be renamed

SPF_data = pd.read_csv("SPF WT vs Bmal1KO RMR.txt", header=0)
SPF_data["Date_Time"] = pd.to_datetime(SPF_data["Date_Time"])

GF_data = pd.read_csv('GF RMR.txt', header = 0)
GF_data['Date_Time'] = pd.to_datetime(GF_data['Date_Time'])

SPF_data_day, SPF_data_night = mt.trim_day_night(SPF_data, 2)
GF_data_day, GF_data_night = mt.trim_day_night(GF_data, 2)

SPF_groups = {"SPF WT":[1,2,3,5,6]}
GF_groups = {"GF WT":np.arange(1,6).tolist()}

RMR_SPF = mt.avg0(SPF_data_night, SPF_groups, "VO2")
RMR_GF = mt.avg0(GF_data_night, GF_groups, "VO2")

RMR = RMR_SPF["SPF WT"].tolist()
RMR.extend(RMR_GF["GF WT"].tolist())

bodymass = mt.liic(SPF_data_night, SPF_groups, "BodyMass") + mt.liic(GF_data_night, GF_groups, "BodyMass")

meta = np.array(["SPF", "GF"]).repeat([5,5]).tolist()

pd.DataFrame({"microbes":meta, "RMR":RMR, "BodyMass":bodymass}).to_csv("SPF vs GF VO2 mass covariate data.txt", index=False)
```

The dataframe was imported to R and ANCOVA was run.

```R
library(car)
library(compute.es)
library(effects)
library(multcomp)
library(pastecs)
library(WRS2)
library(ggplot2)
require(gridExtra)

df <- read.csv2("SPF vs GF VO2 mass covariate data.txt", sep=",")
df$microbes <- factor(c(rep(1,5),rep(2,5)), levels = c(1:2), labels = c("SPF", "GF"))

df$RMR <- as.numeric(as.character(df$RMR))
df$BodyMass <- as.numeric(as.character(df$BodyMass))

plot1 <- ggplot(df, aes(x=microbes, y=RMR)) +
  geom_boxplot() +
  ggtitle("RMR vs microbial condition")
plot2 <- ggplot(df, aes(x=microbes, y=BodyMass)) +
  geom_boxplot() +
  ggtitle("BodyMass vs microbial condition")
grid.arrange(plot1, plot2, ncol=2)

by(df$RMR, df$microbes, stat.desc)
by(df$BodyMass, df$microbes, stat.desc)

leveneTest(df$RMR, df$microbes, center = median)
# Not significant, validation for ANCOVA vs ANOVA.

model <- aov(RMR ~ microbes + BodyMass, data = df)
summary(model)
Anova(model, type= "III")
```

Graphical output

![RMR vs microbes](../img/ANCOVA_variates.png)

Terminal output:

```R
> leveneTest(df$RMR, df$microbes, center = median)
Levenes Test for Homogeneity of Variance (center = median)
      Df F value Pr(>F)
group  1  0.0117 0.9166
       8
> summary(model)
            Df  Sum Sq Mean Sq F value Pr(>F)  
microbes     1 0.03123 0.03123   3.824 0.0914 .
BodyMass     1 0.06532 0.06532   7.996 0.0255 *
Residuals    7 0.05718 0.00817                 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

> Anova(model, type= "III")
Anova Table (Type III tests)

Response: RMR
              Sum Sq Df F value  Pr(>F)  
(Intercept) 0.016860  1  2.0641 0.19395  
microbes    0.003064  1  0.3751 0.55958  
BodyMass    0.065316  1  7.9964 0.02549 *
Residuals   0.057177  7                  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
```

So, I found a significant effect of bodymass on RMR at dark, but a nonsignificant effect of microbiome presence or absence.

Next, I need to try the same thing with BMR and light cycle RMR, and including other covariates (e.g. food, water consumption, movement)
